import{X as a,a as e,aD as s,aE as t,aF as o,aG as r,aH as n,Z as c,c as i,aw as u,$ as d}from"./index-Dlau7bkh.js";async function p(i,u){const{onProgressUpdate:d,onTask:p}=u||{},{mode:l,type:m}=await a.base.comm.uploadMode(),{user:f}=e(),h="local"==l,k=s()+"_"+(i.name||t(i.path)),b=h?k:o("app",r().format("YYYY-MM-DD"),k);return new Promise(((e,s)=>{function t({host:a,preview:t,data:r}){const c={...r,key:b},u=n({url:a,filePath:i.path,name:"file",header:h?{Authorization:f.token}:{},formData:c,success(r){if(h){const{code:a,data:t,message:o}=JSON.parse(r.data);1e3==a?e(t):s(o)}else e(o(t||a,c.key))},fail(a){s(a)}});p&&p(u),d&&u.onProgressUpdate(d)}h?t({host:c.baseUrl+"/app/base/comm/upload"}):a.base.comm.upload("aws"==m?{key:b}:{}).then((a=>{switch(m){case"cos":t({host:a.url,data:a.credentials});break;case"oss":t({host:a.host,data:{OSSAccessKeyId:a.OSSAccessKeyId,policy:a.policy,signature:a.signature}});break;case"qiniu":t({host:a.uploadUrl,preview:a.publicDomain,data:{token:a.token}});break;case"aws":t({host:a.url,data:a.fields})}})).catch(s)}))}function l(){const a=i({});return{refs:a,setRefs:function(e){return s=>{a[e]=s}}}}function m(){return{router:u,service:a,upload:p,storage:d,...l()}}export{l as a,p as b,m as u};
