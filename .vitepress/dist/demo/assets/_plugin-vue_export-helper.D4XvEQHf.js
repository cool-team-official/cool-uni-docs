import{T as a,n as s,am as e,an as o,ao as t,ap as r,aq as n,V as c,p as i,ad as u,X as p}from"./index-BXs9N0aO.js";async function d(i,u){const{onProgressUpdate:p,onTask:d}=u||{},{mode:l,type:f}=await a.base.comm.uploadMode(),{user:m}=s(),h="local"==l,k=e()+"_"+(i.name||o(i.path)),b=h?k:t("app",r().format("YYYY-MM-DD"),k);return new Promise(((s,e)=>{function o({host:a,preview:o,data:r}){const c={...r,key:b},u=n({url:a,filePath:i.path,name:"file",header:h?{Authorization:m.token}:{},formData:c,success(r){if(h){const{code:a,data:o,message:t}=JSON.parse(r.data);1e3==a?s(o):e(t)}else s(t(o||a,c.key))},fail(a){e(a)}});d&&d(u),p&&u.onProgressUpdate(p)}h?o({host:c.baseUrl+"/app/base/comm/upload"}):a.base.comm.upload("aws"==f?{key:b}:{}).then((a=>{switch(f){case"cos":o({host:a.url,data:a.credentials});break;case"oss":o({host:a.host,data:{OSSAccessKeyId:a.OSSAccessKeyId,policy:a.policy,signature:a.signature}});break;case"qiniu":o({host:a.uploadUrl,preview:a.publicDomain,data:{token:a.token}});break;case"aws":o({host:a.url,data:a.fields})}})).catch(e)}))}function l(){const a=i({});return{refs:a,setRefs:function(s){return e=>{a[s]=e}}}}function f(){return{router:u,service:a,upload:d,storage:p,...l()}}const m=(a,s)=>{const e=a.__vccOpts||a;for(const[o,t]of s)e[o]=t;return e};export{m as _,l as a,d as b,f as u};
