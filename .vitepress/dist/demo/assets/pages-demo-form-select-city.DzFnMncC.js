import{d as e,f as l,c as a,A as t,aa as s,ap as o,ab as c,k as u,l as i,o as n,v as r,p as d,w as p,r as m,F as f,x as v,a as _,q as y,t as b,n as h,i as g,y as j,b2 as k,b3 as V,j as C,b4 as x}from"./index-CzDL0q2O.js";import{P as K,_ as A}from"./cl-select-inner.DHYy2Dfi.js";import{_ as w}from"./cl-tag.DaGxL6UT.js";import{_ as R}from"./cl-list-index.DoxV4XcZ.js";import{_ as S}from"./cl-select-popup.jOb3AMsi.js";import{a as F,_ as U}from"./_plugin-vue_export-helper.DhhdjX9X.js";import{C as B}from"./city-pca.BwKYHwgO.js";import{i as D,b as E,a as $}from"./cl-page.DOOy25Dj.js";import{c as q}from"./cloneDeep.DqIkGiC_.js";import{_ as P}from"./cl-card.BV7q8KI_.js";import{_ as z}from"./cl-row.vEnuFd2X.js";import"./cl-input.BhKaWqP9.js";import"./cl-checkbox.cwWilR-M.js";import"./isBoolean.B7PhcbKY.js";import"./cl-avatar.BF6NFmJl.js";import"./cl-empty.C4ruRpwK.js";import"./cl-text.BgGzwGdy.js";const G=U(e({name:"cl-select-city",props:{...K,data:{type:Array,default:B},modelValue:Array,title:{type:String,default:"请选择所在地区"},labelKey:{type:String,default:"name"},valueKey:{type:String,default:"name"},placeholder:{type:String,default:"请选择所在地区"},separator:{type:String,default:" - "}},emits:["update:modelValue","change"],setup(e,{emit:u}){const{refs:i,setRefs:n}=F(),r=l([]),d=l(0),p=a((()=>{let l=e.data;const a=r.value.map((a=>{const t=l.find((l=>l[e.valueKey]==a));return t?(l=t.children||[],l):[]}));return[e.data,...a].filter((e=>!D(e)))})),m=a((()=>r.value.map(((l,a)=>p.value[a].find((a=>a[e.valueKey]==l)))))),f=l([]),v=a((()=>f.value.map((l=>null==l?void 0:l[e.labelKey])).join(e.separator)));function _(l){r.value=q(l||e.modelValue||[]),(D(r.value)||r.value.find((e=>!e)))&&(r.value=[""],d.value=0),f.value=m.value.filter(Boolean).map((e=>({...e,children:void 0})))}const y=t({list:[],create(){y.list=r.value.map(o)},update(){r.value.forEach(((e,l)=>{e||(y.list.splice(l,99),y.list[l]=o())}))}});function b(){i.popup.close()}function h(){u("update:modelValue",r.value),u("change",r.value),b()}return s((()=>e.modelValue),_,{immediate:!0,deep:!0}),{refs:i,setRefs:n,list:p,value:r,cache:y,text:v,tabs:m,selection:f,confirm:h,open:function(){i.popup.open(),_(),y.create()},close:b,select:function(l,a){r.value[a]&&r.value.splice(a,99),r.value[a]=l[e.valueKey];const t=p.value[a].find((l=>l[e.valueKey]==r.value[a]));D(null==t?void 0:t.children)?h():(r.value.push(""),y.update(),c((()=>{d.value+=1})))},onActiveChange:function(e){d.value=e.detail.current},active:d,toActive:function(e){d.value=void 0!==e?e:r.value.length}}}}),[["render",function(e,l,a,t,s,o){const c=u(i("cl-select-inner"),A),C=g,x=u(i("cl-tag"),w),K=j,F=u(i("cl-list-index"),R),U=k,B=V,D=u(i("cl-select-popup"),S);return n(),r(f,null,[d(C,{class:"cl-select-city",onClick:e.open},{default:p((()=>[m(e.$slots,"default",{value:e.modelValue,label:e.text,selection:e.selection},(()=>[d(c,{height:e.height,placeholder:e.placeholder,disabled:e.disabled,border:e.border,round:e.round,backgroundColor:e.backgroundColor,borderRadius:e.borderRadius,padding:e.padding,text:e.text},null,8,["height","placeholder","disabled","border","round","backgroundColor","borderRadius","padding","text"])]))])),_:3},8,["onClick"]),d(D,{ref:e.setRefs("popup"),title:e.title,"show-picker":!1,"show-footer":!1,"scroller-height":"70vh"},{list:p((()=>[d(C,{class:"cl-select-city__wrap"},{default:p((()=>[d(C,{class:"cl-select-city__tabs"},{default:p((()=>[(n(!0),r(f,null,v(e.tabs,((l,a)=>(n(),_(x,{key:a,round:"",type:e.active==a?"primary":"info",margin:[0,20,20,0],onClick:l=>e.toActive(a)},{default:p((()=>[y(b((null==l?void 0:l[e.labelKey])||"请选择"),1)])),_:2},1032,["type","onClick"])))),128))])),_:1}),d(C,{class:"cl-select-city__list"},{default:p((()=>[d(B,{current:e.active,onChange:e.onActiveChange},{default:p((()=>[(n(!0),r(f,null,v(e.list,((l,a)=>(n(),_(U,{key:e.cache.list[a]},{default:p((()=>[d(F,{data:l,"search-bar":!1,dict:{id:e.valueKey},delay:500},{item:p((({item:l})=>[d(C,{class:h(["cl-select-city__item",{"is-active":l[e.valueKey]==e.value[a]}]),onClick:t=>e.select(l,a)},{default:p((()=>[d(K,{class:"cl-icon-toast-success"}),d(K,null,{default:p((()=>[y(b(l[e.labelKey]),1)])),_:2},1024)])),_:2},1032,["class","onClick"])])),_:2},1032,["data","dict"])])),_:2},1024)))),128))])),_:1},8,["current","onChange"])])),_:1})])),_:1})])),confirm:p((()=>[])),_:1},8,["title"])],64)}]]),H=e({__name:"select-city",setup(e){const a=l([]),t=l([]),s=l([]),o=l();return C((()=>{x({url:"https://cool-service.oss-cn-shanghai.aliyuncs.com/app%2Fbase%2F8fe445f06db5463386ae940d45b4bd6c_city-pcas.json",success(e){o.value=e.data}})})),(e,l)=>{const c=u(i("cl-select-city"),G),m=u(i("cl-card"),P),h=u(i("cl-tag"),w),g=u(i("cl-row"),z),j=u(i("cl-button"),E),k=u(i("cl-page"),$);return n(),_(k,{padding:20},{default:p((()=>[d(m,{label:"基础用法"},{default:p((()=>[d(c,{modelValue:a.value,"onUpdate:modelValue":l[0]||(l[0]=e=>a.value=e)},null,8,["modelValue"])])),_:1}),d(m,{label:"省市区乡镇4级"},{default:p((()=>[d(c,{modelValue:t.value,"onUpdate:modelValue":l[1]||(l[1]=e=>t.value=e),data:o.value,placeholder:"省市区县、乡镇"},null,8,["modelValue","data"])])),_:1}),d(m,{label:"自定义"},{default:p((()=>[d(c,{modelValue:s.value,"onUpdate:modelValue":l[2]||(l[2]=e=>s.value=e)},{default:p((({selection:e})=>[d(g,null,{default:p((()=>[(n(!0),r(f,null,v(e,(e=>(n(),_(h,{margin:[0,20,20,0],plain:"",round:"",key:e.code},{default:p((()=>[y(b(e.name),1)])),_:2},1024)))),128))])),_:2},1024),d(j,{round:""},{default:p((()=>[y("选择所在地区")])),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1})}}});export{H as default};
