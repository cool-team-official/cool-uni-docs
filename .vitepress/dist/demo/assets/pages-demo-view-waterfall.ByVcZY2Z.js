import{ae as e,a3 as a,af as t,ag as i,ah as n,ai as l,aj as s,p as r,x as o,ak as c,q as u,s as f,a1 as d,al as p,a2 as m,d as g,a7 as h,P as b,c as y,e as v,w,R as F,J as _,l as x,r as A,v as k,a as z,b as j,i as R,F as $,j as q,A as P,f as D,o as S,B as M}from"./index-BXs9N0aO.js";import{_ as B}from"./cl-text.FIltvNqU.js";import{g as C,i as E,p as L,a as N}from"./cl-page.D0l32468.js";import{_ as O}from"./_plugin-vue_export-helper.D4XvEQHf.js";import{_ as U}from"./cl-empty.Db0daYvH.js";import{_ as K}from"./cl-loadmore.m5YN6J_W.js";import{u as T}from"./index.BeCewKBR.js";import"./cl-divider.bG88Jigs.js";var V=e?e.isConcatSpreadable:void 0;function H(e){return a(e)||t(e)||!!(V&&e&&e[V])}function I(e,a,t,n,l){var s=-1,r=e.length;for(t||(t=H),l||(l=[]);++s<r;){var o=e[s];a>0&&t(o)?a>1?I(o,a-1,t,n,l):i(l,o):n||(l[l.length]=o)}return l}function Q(e,t){return I(function(e,t){return(a(e)?l:s)(e,n(t))}(e,t),1)}const W=O(g({name:"cl-waterfall-column",setup(){const{proxy:e}=m(),a=C("cl-waterfall",["column","gutter"],["getRect"]);return{width:o((()=>`calc(${100/a.value.column}% - ${a.value.gutter}rpx)`)),margin:o((()=>`0 ${a.value.gutter/2}rpx`)),getRect:function(){return new Promise((a=>{h((()=>{b().in(e).select(".cl-waterfall-column").boundingClientRect(a).exec()}))}))}}}}),[["render",function(e,a,t,i,n,l){const s=x;return y(),v(s,{class:"cl-waterfall-column",style:_({margin:e.margin,width:e.width})},{default:w((()=>[F(e.$slots,"default")])),_:3},8,["style"])}]]);const X=O(g({name:"cl-waterfall",props:{column:{type:Number,default:2},gutter:{type:Number,default:20},direction:{type:String,default:"horizontal"},nodeKey:{type:String,default:"id"}},setup(e){const{proxy:a}=m(),t=A(!0),i=A([]);let n=[];const l=o((()=>"vertical"==e.direction?e.column:"none")),s=o((()=>"vertical"==e.direction?L(e.gutter):"none")),r=o((()=>0==i.value.filter((e=>!E(e))).length));async function c(e){n=e;for(let t=0;t<e.length;t++){const n=async()=>{const n=await new Promise((e=>{h((()=>{b().in(a.$root).selectAll(".cl-waterfall-column").boundingClientRect(e).exec()}))}));return(!E(n)||0===t)&&Promise.all(n).then((a=>{var n;let l=a.map((e=>e.height)),s=Math.min(...l),r=l.indexOf(s);return r<0&&(r=0),null==(n=i.value[r])||n.push(e[t]),!0}))};await n()}}function u(){E(Q(i.value))&&!E(n)&&c(n)}return k((()=>{u()})),{visible:t,list:i,columnCount:l,columnGap:s,refresh:function(a){t.value=!1,h((()=>{switch(t.value=!0,e.direction){case"horizontal":i.value=new Array(e.column).fill(1).map((()=>[])),h((()=>{c(a)}));break;case"vertical":i.value=a}}))},append:c,update:function(a,t){const n=i=>{const n=i[e.nodeKey]===a;return n&&Object.assign(i,t),Boolean(n)};switch(e.direction){case"horizontal":i.value.find((e=>e.find(n)));break;case"vertical":i.value.find(n)}},clear:function(){i.value=[]},showEmpty:r,doLayout:u}}}),[["render",function(e,a,t,i,n,l){const s=x,r=z(j("cl-empty"),U);return e.visible?(y(),v(s,{key:0,class:"cl-waterfall"},{default:w((()=>["vertical"===e.direction?(y(!0),R($,{key:0},q(e.list,((a,t)=>(y(),v(s,{class:"cl-waterfall__item",key:t},{default:w((()=>[F(e.$slots,"default",{item:a,index:t})])),_:2},1024)))),128)):"horizontal"===e.direction?F(e.$slots,"default",{key:1,list:e.list}):P("",!0),e.showEmpty?F(e.$slots,"empty",{key:2},(()=>[D(r)])):P("",!0)])),_:3})):P("",!0)}]]),Z=O(g({__name:"waterfall",setup(e,{expose:a}){const{onRefresh:t,onData:i}=function(e=[]){const{proxy:a}=m(),t=T(),i=r({params:{},pagination:{page:1,size:20,total:0},list:e,loading:!1,finished:!1}),n={},l=o((()=>i.list));async function s(e){if(i.loading)return!1;a.refresh?await a.refresh(e):a.$.exposed.refresh?await a.$.exposed.refresh(e):console.log("use defineExpose({ refresh })")}function g(){h=!1,t.hideLoading()}let h=!0;return c((()=>{h&&(i.finished||s({page:i.pagination.page+1}))})),u((async()=>{h&&(await s({page:1}),f())})),d(g),p(g),{pager:i,list:l,onData:function(e){n.onData=e},onRefresh:function(e={},a){const{clear:l,loading:s=!0}=a||{};l&&1==e.page&&(i.list=[],i.finished=!1),Object.assign(i.params,e);const r={...i.pagination,...i.params,total:void 0};function o(){t.hideLoading(),i.loading=!1}return 1==r.page&&s&&t.showLoading(),i.loading=!0,{data:r,done:o,next:e=>new Promise(((a,l)=>{e.then((e=>{1==r.page?i.list=e.list:i.list.push(...e.list),n.onData&&n.onData(e.list),i.finished=i.list.length===e.pagination.total,i.pagination=e.pagination,o(),a(e)})).catch((e=>{o(),t.showToast(e.message),l(e)}))}))}},onPullDownRefresh:u,onReachBottom:c}}(),n=A(),l=A(!1);function s(e){const{data:a,next:s}=t(e);return i((e=>{var t,i;1==a.page?null==(t=n.value)||t.refresh(e):null==(i=n.value)||i.append(e)})),l.value=!0,s(new Promise((e=>{setTimeout((()=>{l.value=!1,e({list:[{title:"Watslim 擦窗机器人全自动智能遥控电动擦窗机神器 智能款",url:"https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fhbimg.b0.upaiyun.com%2F47d3d4dab03cd71a8800c389d4dd8d5928ab826c37ac3-Vck8iS_fw658&refer=http%3A%2F%2Fhbimg.b0.upaiyun.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=auto?sec=1654339724&t=ec32099a3891504569cb6ec390154c54"},{title:"富士instax立拍立得 一次成像相机 mini11 冰晶白",url:"https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fhbimg.b0.upaiyun.com%2Feed5cf6958521b0b9e36bb9f28b90d59caffa5e1a661-MdQUZ1_fw658&refer=http%3A%2F%2Fhbimg.b0.upaiyun.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=auto?sec=1654339724&t=16e5d80bab1e1fb385c3e8e14d11e0dd"},{title:"syitren Syitren PARON赛塔林黑胶唱片机HIFi复古",url:"https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fhbimg.b0.upaiyun.com%2F438d277c48a7364d7f5c9947e5cab9b8928de5131b023-llMbUl_fw658&refer=http%3A%2F%2Fhbimg.b0.upaiyun.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=auto?sec=1654339724&t=c648048f6b243018dc3d98c4c2191d15"},{title:"华为路由AX3 凌霄双核/wifi6/智能分频3000M/高速路由器",url:"https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fhbimg.b0.upaiyun.com%2Fed5b7cc0611afb58821f6efa2ccbfc9f9c3f14c11c3a1-2dUtHQ_fw658&refer=http%3A%2F%2Fhbimg.b0.upaiyun.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=auto?sec=1654339724&t=2d4e188339ad12fdceac4217ed6e0e5e"},{title:"千幻魔镜 十代 vr眼镜手机VR 智能3D眼镜VR游戏头盔",url:"https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fhbimg.b0.upaiyun.com%2F111d7605120959a2ca836310277f8daf42855ec639e87-kzE5gK_fw658&refer=http%3A%2F%2Fhbimg.b0.upaiyun.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=auto?sec=1654339724&t=5e37c84f9f506f05e812031c660fe56b"},{title:"神火（supfire） X60-T强光手电筒变焦远射USB充电式",url:"https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fhbimg.b0.upaiyun.com%2F8813230e61b64518e74f2b1b088e96036d62d79231874-bkqhNM_fw658&refer=http%3A%2F%2Fhbimg.b0.upaiyun.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=auto?sec=1654339724&t=0ac1b94c1d8e7478c122dadcd6b3915b"}],pagination:{total:100,page:a.page,size:20}})}),1e3)})))}return S((()=>{s()})),a({refresh:s}),(e,a)=>{const t=M,i=z(j("cl-text"),B),s=x,r=z(j("cl-waterfall-column"),W),o=z(j("cl-waterfall"),X),c=z(j("cl-loadmore"),K),u=z(j("cl-page"),N);return y(),v(u,{padding:20},{default:w((()=>[D(o,{ref_key:"Waterfall",ref:n,column:2},{default:w((({list:e})=>[(y(!0),R($,null,q(e,((e,a)=>(y(),v(r,{key:a},{default:w((()=>[(y(!0),R($,null,q(e,((e,a)=>(y(),v(s,{class:"goods-item",key:a},{default:w((()=>[D(t,{src:e.url,mode:"widthFix"},null,8,["src"]),D(i,{value:e.title,margin:20,"line-height":1.5},null,8,["value"])])),_:2},1024)))),128))])),_:2},1024)))),128))])),_:1},512),D(c,{loading:l.value,divider:!1},null,8,["loading"])])),_:1})}}}),[["__scopeId","data-v-ab4b0e38"]]);export{Z as default};
