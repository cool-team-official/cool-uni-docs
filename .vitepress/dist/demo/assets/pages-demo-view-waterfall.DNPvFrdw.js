import{ah as e,a7 as a,ai as t,aj as n,ak as i,al as l,am as s,A as o,c as r,an as c,B as u,C as f,a5 as d,ao as p,a6 as m,d as g,ab as h,S as b,o as y,a as v,w,r as F,b as _,i as x,f as A,D as k,k as z,l as j,v as R,F as $,x as q,G as D,p as P,j as S,H as C}from"./index-CYp4B_QH.js";import{_ as M}from"./cl-text.0zcdGoXY.js";import{g as B,i as E,p as L,a as N}from"./cl-page.CV4Clf1q.js";import{_ as O}from"./_plugin-vue_export-helper.C5tT7wvf.js";import{_ as U}from"./cl-empty.BYpp4AGE.js";import{_ as H}from"./cl-loadmore.Cq1Rfqbv.js";import{u as K}from"./index.CS5AuKI6.js";import"./cl-divider.X3p2vStP.js";var T=e?e.isConcatSpreadable:void 0;function V(e){return a(e)||t(e)||!!(T&&e&&e[T])}function G(e,a,t,i,l){var s=-1,o=e.length;for(t||(t=V),l||(l=[]);++s<o;){var r=e[s];a>0&&t(r)?a>1?G(r,a-1,t,i,l):n(l,r):i||(l[l.length]=r)}return l}function I(e,t){return G(function(e,t){return(a(e)?l:s)(e,i(t))}(e,t),1)}const Q=O(g({name:"cl-waterfall-column",setup(){const{proxy:e}=m(),a=B("cl-waterfall",["column","gutter"],["getRect"]);return{width:r((()=>`calc(${100/a.value.column}% - ${a.value.gutter}rpx)`)),margin:r((()=>`0 ${a.value.gutter/2}rpx`)),getRect:function(){return new Promise((a=>{h((()=>{b().in(e).select(".cl-waterfall-column").boundingClientRect(a).exec()}))}))}}}}),[["render",function(e,a,t,n,i,l){const s=x;return y(),v(s,{class:"cl-waterfall-column",style:_({margin:e.margin,width:e.width})},{default:w((()=>[F(e.$slots,"default")])),_:3},8,["style"])}]]);const W=O(g({name:"cl-waterfall",props:{column:{type:Number,default:2},gutter:{type:Number,default:20},direction:{type:String,default:"horizontal"},nodeKey:{type:String,default:"id"}},setup(e){const{proxy:a}=m(),t=A(!0),n=A([]);let i=[];const l=r((()=>"vertical"==e.direction?e.column:"none")),s=r((()=>"vertical"==e.direction?L(e.gutter):"none")),o=r((()=>0==n.value.filter((e=>!E(e))).length));async function c(e){i=e;for(let t=0;t<e.length;t++){const i=async()=>{const i=await new Promise((e=>{h((()=>{b().in(a.$root).selectAll(".cl-waterfall-column").boundingClientRect(e).exec()}))}));return(!E(i)||0===t)&&Promise.all(i).then((a=>{var i;let l=a.map((e=>e.height)),s=Math.min(...l),o=l.indexOf(s);return o<0&&(o=0),null==(i=n.value[o])||i.push(e[t]),!0}))};await i()}}function u(){E(I(n.value))&&!E(i)&&c(i)}return k((()=>{u()})),{visible:t,list:n,columnCount:l,columnGap:s,refresh:function(a){t.value=!1,h((()=>{switch(t.value=!0,e.direction){case"horizontal":n.value=new Array(e.column).fill(1).map((()=>[])),h((()=>{c(a)}));break;case"vertical":n.value=a}}))},append:c,update:function(a,t){const i=n=>{const i=n[e.nodeKey]===a;return i&&Object.assign(n,t),Boolean(i)};switch(e.direction){case"horizontal":n.value.find((e=>e.find(i)));break;case"vertical":n.value.find(i)}},clear:function(){n.value=[]},showEmpty:o,doLayout:u}}}),[["render",function(e,a,t,n,i,l){const s=x,o=z(j("cl-empty"),U);return e.visible?(y(),v(s,{key:0,class:"cl-waterfall"},{default:w((()=>["vertical"===e.direction?(y(!0),R($,{key:0},q(e.list,((a,t)=>(y(),v(s,{class:"cl-waterfall__item",key:t},{default:w((()=>[F(e.$slots,"default",{item:a,index:t})])),_:2},1024)))),128)):"horizontal"===e.direction?F(e.$slots,"default",{key:1,list:e.list}):D("",!0),e.showEmpty?F(e.$slots,"empty",{key:2},(()=>[P(o)])):D("",!0)])),_:3})):D("",!0)}]]),X=O(g({__name:"waterfall",setup(e,{expose:a}){const{onRefresh:t,onData:n}=function(e=[]){const{proxy:a}=m(),t=K(),n=o({params:{},pagination:{page:1,size:20,total:0},list:e,loading:!1,finished:!1}),i={},l=r((()=>n.list));async function s(e){if(n.loading)return!1;a.refresh?await a.refresh(e):a.$.exposed.refresh?await a.$.exposed.refresh(e):console.log("use defineExpose({ refresh })")}function g(){h=!1,t.hideLoading()}let h=!0;return c((()=>{h&&(n.finished||s({page:n.pagination.page+1}))})),u((async()=>{h&&(await s({page:1}),f())})),d(g),p(g),{pager:n,list:l,onData:function(e){i.onData=e},onRefresh:function(e={},a){const{clear:l,loading:s=!0}=a||{};l&&1==e.page&&(n.list=[],n.finished=!1),Object.assign(n.params,e);const o={...n.pagination,...n.params,total:void 0};function r(){t.hideLoading(),n.loading=!1}return 1==o.page&&s&&t.showLoading(),n.loading=!0,{data:o,done:r,next:e=>new Promise(((a,l)=>{e.then((e=>{1==o.page?n.list=e.list:n.list.push(...e.list),i.onData&&i.onData(e.list),n.finished=n.list.length===e.pagination.total,n.pagination=e.pagination,r(),a(e)})).catch((e=>{r(),t.showToast(e.message),l(e)}))}))}},onPullDownRefresh:u,onReachBottom:c}}(),i=A(),l=A(!1);function s(e){const{data:a,next:s}=t(e);return n((e=>{var t,n;1==a.page?null==(t=i.value)||t.refresh(e):null==(n=i.value)||n.append(e)})),l.value=!0,s(new Promise((e=>{setTimeout((()=>{l.value=!1,e({list:[{title:"Watslim 擦窗机器人全自动智能遥控电动擦窗机神器 智能款",url:"https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fhbimg.b0.upaiyun.com%2F47d3d4dab03cd71a8800c389d4dd8d5928ab826c37ac3-Vck8iS_fw658&refer=http%3A%2F%2Fhbimg.b0.upaiyun.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=auto?sec=1654339724&t=ec32099a3891504569cb6ec390154c54"},{title:"富士instax立拍立得 一次成像相机 mini11 冰晶白",url:"https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fhbimg.b0.upaiyun.com%2Feed5cf6958521b0b9e36bb9f28b90d59caffa5e1a661-MdQUZ1_fw658&refer=http%3A%2F%2Fhbimg.b0.upaiyun.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=auto?sec=1654339724&t=16e5d80bab1e1fb385c3e8e14d11e0dd"},{title:"syitren Syitren PARON赛塔林黑胶唱片机HIFi复古",url:"https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fhbimg.b0.upaiyun.com%2F438d277c48a7364d7f5c9947e5cab9b8928de5131b023-llMbUl_fw658&refer=http%3A%2F%2Fhbimg.b0.upaiyun.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=auto?sec=1654339724&t=c648048f6b243018dc3d98c4c2191d15"},{title:"华为路由AX3 凌霄双核/wifi6/智能分频3000M/高速路由器",url:"https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fhbimg.b0.upaiyun.com%2Fed5b7cc0611afb58821f6efa2ccbfc9f9c3f14c11c3a1-2dUtHQ_fw658&refer=http%3A%2F%2Fhbimg.b0.upaiyun.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=auto?sec=1654339724&t=2d4e188339ad12fdceac4217ed6e0e5e"},{title:"千幻魔镜 十代 vr眼镜手机VR 智能3D眼镜VR游戏头盔",url:"https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fhbimg.b0.upaiyun.com%2F111d7605120959a2ca836310277f8daf42855ec639e87-kzE5gK_fw658&refer=http%3A%2F%2Fhbimg.b0.upaiyun.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=auto?sec=1654339724&t=5e37c84f9f506f05e812031c660fe56b"},{title:"神火（supfire） X60-T强光手电筒变焦远射USB充电式",url:"https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fhbimg.b0.upaiyun.com%2F8813230e61b64518e74f2b1b088e96036d62d79231874-bkqhNM_fw658&refer=http%3A%2F%2Fhbimg.b0.upaiyun.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=auto?sec=1654339724&t=0ac1b94c1d8e7478c122dadcd6b3915b"}],pagination:{total:100,page:a.page,size:20}})}),1e3)})))}return S((()=>{s()})),a({refresh:s}),(e,a)=>{const t=C,n=z(j("cl-text"),M),s=x,o=z(j("cl-waterfall-column"),Q),r=z(j("cl-waterfall"),W),c=z(j("cl-loadmore"),H),u=z(j("cl-page"),N);return y(),v(u,{padding:20},{default:w((()=>[P(r,{ref_key:"Waterfall",ref:i,column:2},{default:w((({list:e})=>[(y(!0),R($,null,q(e,((e,a)=>(y(),v(o,{key:a},{default:w((()=>[(y(!0),R($,null,q(e,((e,a)=>(y(),v(s,{class:"goods-item",key:a},{default:w((()=>[P(t,{src:e.url,mode:"widthFix"},null,8,["src"]),P(n,{value:e.title,margin:20,"line-height":1.5},null,8,["value"])])),_:2},1024)))),128))])),_:2},1024)))),128))])),_:1},512),P(c,{loading:l.value,divider:!1},null,8,["loading"])])),_:1})}}}),[["__scopeId","data-v-ab4b0e38"]]);export{X as default};
