import{c as e,_ as a,d as s,a as o}from"./cl-page.C3y_EXfh.js";import{d as l,b as t,c as n,r as i,B as d,e as c,f as u,g as r,h as p,w as f,v as h,V as m,j as g,l as v,k as b,t as _,q as w}from"./index-Dlau7bkh.js";import{_ as x}from"./cl-text.DUw3LhC2.js";import{_ as z}from"./cl-input.Cxen37Qp.js";import{u as j}from"./index.AbH2Jzti.js";import{u as k}from"./index.Dnq2RgDG.js";import{_ as C}from"./_plugin-vue_export-helper.BCo6x5W8.js";const I=l({name:"undefined"}),V=C(l({...I,props:{phone:String,type:String,height:Number,fontSize:Number,size:String,border:{type:Boolean,default:!0},plain:Boolean},emits:["success"],setup(l,{expose:C,emit:I}){const V=l,y=I,{service:S,refs:T,setRefs:$}=j(),B=k(),{t:F}=t(),N=n({visible:!1,loading:!1,sending:!1,img:""}),U=i(0),q=d((()=>U.value>0||!V.phone)),E=d((()=>U.value>0?F("{n}s后重新获取",{n:U.value}):F("获取验证码"))),R=n({code:"",captchaId:""});function A(){function e(){U.value--,U.value<1&&clearInterval(a)}U.value=60;const a=setInterval(e,1e3);e()}async function D(){R.code?(N.sending=!0,await S.user.login.smsCode({phone:V.phone,...R}).then((()=>{B.showToast(F("短信已发送，请查收")),A(),J(),y("success")})).catch((e=>{B.showToast(e.message),G()})),N.sending=!1):B.showToast(F("请填写验证码"))}async function G(){K(),N.loading=!0,await S.user.login.captcha({color:"#2c3142",phone:V.phone}).then((e=>{R.captchaId=e.captchaId,N.img=e.data})).catch((e=>{B.showToast(e.message)})),N.loading=!1}function H(){V.phone&&(/^(?:(?:\+|00)86)?1[3-9]\d{9}$/.test(V.phone)?(N.visible=!0,G()):B.showToast(F("请填写正确的手机号格式")))}function J(){N.visible=!1,K()}function K(){R.code="",R.captchaId=""}return C({open:H,send:D,getCaptcha:G,startCountdown:A}),(t,n)=>{const i=c(u("cl-button"),e),d=c(u("cl-text"),x),j=c(u("cl-icon"),a),k=h,C=c(u("cl-input"),z),I=w,V=c(u("cl-loading-mask"),s),y=c(u("cl-popup"),o);return r(),p(k,{class:"sms-btn"},{default:f((()=>[m(t.$slots,"default",{disabled:q.value,countdown:U.value,btnText:E.value},(()=>[g(i,{border:!1,"background-color":"transparent",color:"#FE6B03",height:l.height,"font-size":l.fontSize,fill:"",size:l.size,disabled:q.value,onClick:H},{default:f((()=>[b(_(E.value),1)])),_:1},8,["height","font-size","size","disabled"])]),!0),g(y,{modelValue:N.visible,"onUpdate:modelValue":n[1]||(n[1]=e=>N.visible=e),ref:v($)("popup"),padding:40,"border-radius":"24rpx"},{default:f((()=>[g(V,{loading:N.loading},{default:f((()=>[g(k,{class:"sms-popup"},{default:f((()=>[g(k,{class:"head"},{default:f((()=>[g(d,{bold:"",size:28,value:t.$t("获取短信验证码")},null,8,["value"]),g(j,{size:32,name:"close",onClick:J})])),_:1}),g(k,{class:"row"},{default:f((()=>{var e;return[g(C,{modelValue:R.code,"onUpdate:modelValue":n[0]||(n[0]=e=>R.code=e),placeholder:t.$t("验证码"),maxlength:4,height:70,clearable:!1,focus:null==(e=v(T).popup)?void 0:e.isFocus,border:!1,"background-color":"#f7f7f7",onConfirm:D},null,8,["modelValue","placeholder","focus"]),g(I,{src:N.img,mode:"aspectFit",onClick:G},null,8,["src"])]})),_:1}),g(i,{type:"primary",fill:"",disabled:!R.code,loading:N.sending,height:70,onClick:D},{default:f((()=>[b(_(t.$t("发送短信")),1)])),_:1},8,["disabled","loading"])])),_:1})])),_:1},8,["loading"])])),_:1},8,["modelValue"])])),_:3})}}}),[["__scopeId","data-v-301e9f17"]]);export{V as S};
